<html>
<head>
<title>Gastenboekje</title>
</head>
<body>
<h1>Welcome to the Gezichtsboek Gastenboek feature!</h1>
<?php 

if(!isset($_GET['page'])){
    header('Location: index.php?page=main');
}
if($_GET['page'] == 'main'){
    echo "<a href='index.php?page=view'>View the entries</a><br /><a href='index.php?page=add'>Add a new entry</a>";
    //database setup should have been handled by the deploy script.
}elseif($_GET['page'] == 'add' && (!isset($_POST['text'])||!isset($_POST['name']))){
    echo "<h3>Add a new entry:</h3>";
    echo "<form action='index.php?page=add' method='post'>";
    echo "Name: <input type='text' name='name' id='name'>";
    echo "<br />";
    echo "Text: <br /><textarea name='text' id='text' COLS=40 ROWS=6></textarea>";
    echo "<br />";
    echo "<input type='submit'>";
    echo "</form>";
    echo "<br /><a href='index.php?page=view'>View the entries</a>";
} elseif($_GET['page'] == 'add' && isset($_POST['name']) && isset($_POST['text'])){    
    $db = new PDO('sqlite:entries.sqlite');
    $db->exec("INSERT INTO entries (name, text) VALUES ('".$_POST['name']."', '".$_POST['text']."');");
    echo "Bedankt voor je toevoeging! Hij wordt zeer zeker gewardeerd door iedereen denk ik.";
    echo "<br /><br />";
    echo "<br /><a href='index.php?page=view'>View the entries</a>";
} elseif($_GET['page'] == 'view') {
    if(!isset($_GET['id'])) {$_GET['id']=1;}    
    echo "<h3>Entry ".$_GET['id'].":</h3>";
    $db = new PDO('sqlite:entries.sqlite');
    try {
    $ress = $db->query("SELECT * FROM entries WHERE id=".$_GET['id']." LIMIT 1;");
    $res = $ress->fetch();
    }catch(PDOException $e){print 'Exception : '.$e->getMessage();}
    echo "<hr /><br />";
    echo "<table border=1>";
    echo "<tr>";
    echo "<td>id:</td><td>".$res['id']."</td>";
    echo "</tr>";
    echo "<tr>";
    echo "<td>Name:</td><td>".$res['name']."</td>";
    echo "</tr>";
    echo "<tr>";
    echo "<td>".$res['text']."</td>";
    echo "</tr>";
    echo "</table>";
    echo "<br /><hr />";
    $total = $db->query("SELECT COUNT(*) FROM entries;")->fetch();
    $totalids = intval($total[0]);
    $id = $_GET['id'];
    if($id!=1) {echo "<a href='index.php?page=view&id=".($id-1)."'>previous entry</a>   ";}
if($id<=($totalids-1)){echo "  <a href='index.php?page=view&id=".($id+1)."'>next entry</a>";}
    echo "<br /><a href='index.php?page=add'>Add a new entry</a>";
} elseif($_GET['page'] == 'create'){
    $db = new PDO('sqlite:entries.sqlite');
    $db->exec("CREATE TABLE IF NOT EXISTS entries (id INTEGER PRIMARY KEY, name TEXT, text TEXT);");
    echo "Database succesfully created!";
} else {
    header('Location: index.php?page=main');
}

?>
</body>
</html>
